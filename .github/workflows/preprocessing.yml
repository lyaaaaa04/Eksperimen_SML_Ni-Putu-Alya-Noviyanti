name: Preprocessing Workflow

# Trigger workflow
on:
  push:
    branches:
      - main
  workflow_dispatch:  # memungkinkan trigger manual di GitHub UI

jobs:
  preprocess:
    runs-on: ubuntu-latest

    steps:
    # 1. Checkout repository
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2. Set up Python
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'

    # 3. Install dependencies
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt || echo "requirements.txt not found, skipping"

    # 4. Run preprocessing script
    - name: Run preprocessing
      run: |
        python -c "from preprocessing/Automate_Alya import save_preprocessed_csv; save_preprocessed_csv('StudentsPerformance_raw.csv','preprocessing/StudentsPerformance_preprocessed.csv')"

    # 5. Optionally commit and push preprocessed file
    - name: Commit preprocessed file
      run: |
        git config --local user.email "alya.noviyanti04@outlook.com"
        git config --local user.name "Alya Noviyanti"
        git add StudentsPerformance_preprocessed.csv
        git commit -m "Update preprocessed dataset [skip ci]" || echo "No changes to commit"
        git push
